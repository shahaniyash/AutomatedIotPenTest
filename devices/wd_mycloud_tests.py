import socket
import os
import cameras.dlink_dcs932
import base64
import subprocess
import paramiko
from cve_checks import smb_vuln_cve_2017_7494

#This tests several potential vulnerabilities in a Western
# Digital MyCloud Hard Drive
# return value: n/a
def test_wd_mycloud(ip_addr):
    #test basic login creds

    #ssh: ssh -oHostKeyAlgorithms=+ssh-dss root@   pass:nothing
    username = "root"
    pw = ""
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(hostname=ip_addr, username=username, password=pw)
        ssh.close()
        print("\n\n\n!!!!!!!!!!Default SSH Creds!!!!!!!!!\n\n\n")
        f = open("results/{}/{}-device_tests.txt".format(ip_addr, ip_addr),"w+")
        f.write("CRITICAL: Default ssh creds authenticate")
        f.close()
    except:
        pass
    #TODO:test default web login
    #TODO: test the backdoor creds web login as well
    #test if vulnerable to sambacry
    if(smb_vuln_cve_2017_7494.test_vuln(ip_addr)):
        f = open("results/{}/{}-device_tests.txt".format(ip_addr, ip_addr), "a+")
        f.write("CRITICAL: vulnerable to CVE-2017-7494")
        f.close()

